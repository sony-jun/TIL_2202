# DataBase

# CASEÂ ğŸ“

## **CASE**Â ğŸ’­

- íŠ¹ì • ìƒí™©ì—ì„œÂ `ë°ì´í„°ë¥¼ ë³€í™˜í•˜ì—¬ í™œìš©`í•  ìˆ˜ ìˆìŒ
- **ELSEë¥¼ ìƒëµí•˜ëŠ” ê²½ìš° NULLê°’ì´ ì§€ì •ë¨**

```sql
CASE    WHEN ì¡°ê±´ì‹ THEN ì‹    WHEN ì¡°ê±´ì‹ THEN ì‹    ELSE ì‹END
```

```sql
SELECT id, gender
FROM healthcare
LIMIT 5;


-- ì„±ë³„1(ë‚¨ì), 2(ì—¬ì) ğŸ’¡
SELECT
    id,    CASE        WHEN gender = 1 THEN 'ë‚¨ì'
        WHEN gender = 2 THEN 'ì—¬ì'
    END AS ì„±ë³„
FROM healthcare
LIMIT 5;


-- í¡ì—° ğŸ’¡
SELECT DISTINCT smoking
FROM healthcare;

SELECT
    id,    smoking,    CASE        WHEN smoking = 1 THEN 'ë¹„í¡ì—°ì'
        WHEN smoking = 2 THEN 'í¡ì—°ì'
        WHEN smoking = 3 THEN 'í—¤ë¹„ìŠ¤ëª¨ì»¤'
        ELSE 'ë¬´ì‘ë‹µ'
    END
FROM healthcare
LIMIT 50;


-- ë‚˜ì´ì— ë”°ë¼ì„œ êµ¬ë¶„í•˜ê¸° ğŸ’¡
SELECT
    first_name,    last_name,    CASE        WHEN age <= 18 THEN 'ì²­ì†Œë…„'
        WHEN age <= 40 THEN 'ì²­ë…„'
        WHEN age <= 90 THEN 'ì¤‘ì¥ë…„'
        ELSE 'ë…¸ë…„'
 END
FROM users
LIMIT 10;
```

---

# [DB] ì„œë¸Œì¿¼ë¦¬Â ğŸ“

## **ì„œë¸Œì¿¼ë¦¬**Â ğŸ’­

- **ì„œë¸Œ ì¿¼ë¦¬ëŠ” íŠ¹ì •í•œ ê°’ì„ ë©”ì¸ ì¿¼ë¦¬ì— ë°˜í™˜í•˜ì—¬ í™œìš©í•˜ëŠ” ê²ƒ**
- ì‹¤ì œ í…Œì´ë¸”ì— ì—†ëŠ” ê¸°ì¤€ì„ ì´ìš©í•œ ê²€ìƒ‰ì´ ê°€ëŠ¥í•¨
- ì„œë¸Œ ì¿¼ë¦¬ëŠ”Â `ì†Œê´„í˜¸ë¡œ ê°ì‹¸ì„œ ì‚¬ìš©`í•˜ë©°,Â `ë©”ì¸ ì¿¼ë¦¬ì˜ ì¹¼ëŸ¼ì„ ëª¨ë‘ ì‚¬ìš©`í•  ìˆ˜ ìˆìŒ
- ë©”ì¸ ì¿¼ë¦¬ëŠ” ì„œë¸Œ ì¿¼ë¦¬ì˜ ì¹¼ëŸ¼ì„ ì´ìš©í•  ìˆ˜ ìˆìŒ

### **ë‹¨ì¼í–‰ ì„œë¸Œì¿¼ë¦¬**

- ì„œë¸Œì¿¼ë¦¬ì˜ ê²°ê³¼ê°€ 0 ë˜ëŠ” 1ê°œì¸ ê²½ìš°
- `ë‹¨ì¼í–‰ ë¹„êµ ì—°ì‚°ìì™€ í•¨ê»˜ ì‚¬ìš© (=, <, <=, >=, >, <>)`

```sql
-- usersì—ì„œ ê°€ì¥ ë‚˜ì´ê°€ ì‘ì€ ì‚¬ëŒì˜ ìˆ˜ëŠ”? ğŸ’­
SELECT age, count(*) FROM users GROUP BY age ORDER BY age LIMIT 1;
-- ê°€ì¥ ì‘ì€ ë‚˜ì´
SELECT min(age) FROM users;
-- ê°€ì¥ ì‘ì€ ë‚˜ì´ì˜ ìˆ˜
SELECT count(*) FROM users WHERE age = 15;
-- ë‹¨ì¼í–‰ ì„œë¸Œì¿¼ë¦¬ ğŸ’¡
SELECT count(*) FROM users WHERE age = (SELECT min(age) FROM users);


-- userì—ì„œ í‰ê·  ê³„ì¢Œ ì”ê³ ê°€ ë†’ì€ ì‚¬ëŒì˜ ìˆ˜ëŠ”? ğŸ’­
SELECT count(*) FROM users WHERE balance > (SELECT avg(balance) FROM users);


-- usersì—ì„œ ìœ ì€ì •ê³¼ ê°™ì€ ì§€ì—­ì— ì‚¬ëŠ” ì‚¬ëŒì˜ ìˆ˜ëŠ”? ğŸ’­
SELECT count(*) FROM users WHERE country = (SELECT country FROM users WHERE last_name = 'ìœ ' AND first_name = 'ì€ì •');


-- ì „ì²´ ì¸ì›ê³¼ í‰ê·  ì—°ë´‰, í‰ê·  ë‚˜ì´ë¥¼ ì¶œë ¥í•˜ì„¸ìš”. ğŸ’­
SELECT count(*), avg(balance), avg(age) FROM users;


-- usersì—ì„œ ì´ì¸ì›ê³¼ í‰ê· ì—°ë´‰ì„ ë³´ì—¬ì¤˜ ğŸ’­
SELECT
    (SELECT count(*) FROM users) AS ì´ì¸ì›,    (SELECT avg(balance) FROM users) AS í‰ê· ì—°ë´‰;


-- usersì˜ ì—°ë´‰ì„ ëª¨ë‘ í‰ê· ì—°ë´‰ìœ¼ë¡œ ë°”ê¿”ì¤˜ ğŸ’­
UPDATE users
SET balance = (SELECT avg(balance) FROM users);
```

### **ë‹¤ì¤‘í–‰ ì„œë¸Œì¿¼ë¦¬**

- ì„œë¸Œì¿¼ë¦¬ ê²°ê³¼ê°€ 2ê°œ ì´ìƒì¸ ê²½ìš°
- `ë‹¤ì¤‘í–‰ ë¹„êµ ì—°ì‚°ìì™€ í•¨ê»˜ ì‚¬ìš© (IN, EXISTS ë“±)`

```sql
SELECT
    country
FROM users
WHERE last_name = 'ì´' AND first_name = 'ì€ì •';


-- ìœ ì€ì •ê³¼ ê°™ì€ ì§€ì—­ì— ì‚¬ëŠ” ì‚¬ëŒì˜ ìˆ˜ëŠ”? ğŸ’­
SELECT
    count(*)
FROM users
WHERE country IN (SELECT country FROM users WHERE last_name = 'ìœ ' AND first_name = 'ì€ì •');


-- íŠ¹ì • ì„±ì”¨ì—ì„œ ê°€ì¥ ì–´ë¦° ì‚¬ëŒë“¤ì˜ ì´ë¦„ê³¼ ë‚˜ì´ëŠ”? ğŸ’­
SELECT
    last_name,    first_name,    age
FROM users
WHERE (last_name, age) IN (  SELECT
      last_name,      min(age)  FROM users  GROUP BY last_name)
ORDER BY last_name;
```

### **ë‹¤ì¤‘ì»¬ëŸ¼ ì„œë¸Œì¿¼ë¦¬**

```sql
-- ID ì¡°íšŒ
SELECT ArtistId
FROM artists
WHERE Name = 'AC/DC';

-- ì„œë¸Œì¿¼ë¦¬
SELECT *
FROM albums
WHERE ArtistId = (  SELECT ArtistId  FROM artists  WHERE Name = 'Queen');
```
